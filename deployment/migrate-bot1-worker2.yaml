apiVersion: v1
kind: Pod
metadata:
  name: migrate-bot1-worker2-v2
  namespace: default
spec:
  nodeName: k8s-worker02-node
  restartPolicy: Never
  volumes:
    - name: host-data
      hostPath:
        path: /home/user/aivis-chan-bot-1st-data
        type: Directory
    - name: target-pvc
      persistentVolumeClaim:
        claimName: aivis-chan-bot-1st-pvc
    - name: host-data-2
      hostPath:
        path: /home/user/aivis-chan-bot-2nd-data
        type: Directory
    - name: target-pvc-2
      persistentVolumeClaim:
        claimName: aivis-chan-bot-2nd-pvc
    - name: host-data-3
      hostPath:
        path: /home/user/aivis-chan-bot-3rd-data
        type: Directory
    - name: target-pvc-3
      persistentVolumeClaim:
        claimName: aivis-chan-bot-3rd-pvc
    - name: host-data-4
      hostPath:
        path: /home/user/aivis-chan-bot-4th-data
        type: Directory
    - name: target-pvc-4
      persistentVolumeClaim:
        claimName: aivis-chan-bot-4th-pvc
    - name: host-data-5
      hostPath:
        path: /home/user/aivis-chan-bot-5th-data
        type: Directory
    - name: target-pvc-5
      persistentVolumeClaim:
        claimName: aivis-chan-bot-5th-pvc
    - name: host-data-6
      hostPath:
        path: /home/user/aivis-chan-bot-6th-data
        type: Directory
    - name: target-pvc-6
      persistentVolumeClaim:
        claimName: aivis-chan-bot-6th-pvc
  containers:
    - name: copier
      image: alpine:3.18
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "500m"
          memory: "512Mi"
      command:
        - /bin/sh
        - -c
        - |
          set -eux
          for i in "" "-2" "-3" "-4" "-5" "-6"; do
            mkdir -p /target${i}
            cd /source${i} && tar cf - . | (cd /target${i} && tar xf -)
          done
          echo "COPY_DONE"
          # chown -R 1000:1000 /target || true
          sleep 3600
      volumeMounts:
        - name: host-data
          mountPath: /source
        - name: target-pvc
          mountPath: /target
        - name: host-data-2
          mountPath: /source-2
        - name: target-pvc-2
          mountPath: /target-2
        - name: host-data-3
          mountPath: /source-3
        - name: target-pvc-3
          mountPath: /target-3
        - name: host-data-4
          mountPath: /source-4
        - name: target-pvc-4
          mountPath: /target-4
        - name: host-data-5
          mountPath: /source-5
        - name: target-pvc-5
          mountPath: /target-5
        - name: host-data-6
          mountPath: /source-6
        - name: target-pvc-6
          mountPath: /target-6
