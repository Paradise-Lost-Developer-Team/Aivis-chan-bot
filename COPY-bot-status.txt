// Bot Statuså°‚ç”¨JavaScript
// ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯bot-status.js ã¨ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„

class BotStatusManager {
    constructor() {
        this.botIds = [
            '1333819940645638154',
            '1334732369831268352', 
            '1334734681656262770',
            '1365633502988472352',
            '1365633586123771934',
            '1365633656173101086'
        ];
        this.botNames = [
            'Aivis-chan Bot 1å°ç›®',
            'Aivis-chan Bot 2å°ç›®',
            'Aivis-chan Bot 3å°ç›®', 
            'Aivis-chan Bot 4å°ç›®',
            'Aivis-chan Bot 5å°ç›®',
            'Aivis-chan Bot 6å°ç›®'
        ];
        this.init();
    }

    init() {
        console.log('ğŸ¤– Bot Status Manager initialized');
        this.updateBotStatus();
        
        // 2åˆ†ã”ã¨ã«Botè©³ç´°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
        setInterval(() => {
            this.updateBotStatus();
        }, 2 * 60 * 1000);
    }

    async updateBotStatus() {
        try {
            const apiBaseUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                ? 'http://localhost:3001'
                : 'https://aivis-chan-bot.com';
                
            const response = await fetch(`${apiBaseUrl}/api/bot-stats`);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            this.updateBotDetailCards(data.bots);
            
        } catch (error) {
            console.error('âŒ Error fetching bot status:', error);
            this.showErrorState();
        }
    }

    updateBotDetailCards(botsData) {
        const botCards = document.querySelectorAll('.bot-detail-card');
        
        botCards.forEach((card, index) => {
            const botData = botsData[index];
            if (botData) {
                this.updateSingleBotCard(card, botData, index);
            }
        });
    }

    updateSingleBotCard(card, botData, index) {
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸æ›´æ–°
        const statusBadge = card.querySelector('.bot-status-badge');
        if (statusBadge) {
            statusBadge.classList.remove('loading', 'online', 'offline');
            if (botData.online && botData.success) {
                statusBadge.classList.add('online');
                statusBadge.textContent = 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³';
            } else {
                statusBadge.classList.add('offline');
                statusBadge.textContent = 'ã‚ªãƒ•ãƒ©ã‚¤ãƒ³';
            }
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        const statItems = card.querySelectorAll('.stat-item .value');
        if (statItems.length >= 3) {
            statItems[0].textContent = botData.success ? botData.server_count.toLocaleString() : '---';
            statItems[1].textContent = botData.success ? botData.user_count.toLocaleString() : '---';
            statItems[2].textContent = botData.success ? `${botData.uptime.toFixed(1)}%` : '---%';
        }

        // ã‚«ãƒ¼ãƒ‰å…¨ä½“ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è§£é™¤
        card.classList.remove('loading');
    }

    showErrorState() {
        const botCards = document.querySelectorAll('.bot-detail-card');
        
        botCards.forEach(card => {
            const statusBadge = card.querySelector('.bot-status-badge');
            if (statusBadge) {
                statusBadge.classList.remove('loading', 'online');
                statusBadge.classList.add('offline');
                statusBadge.textContent = 'ã‚¨ãƒ©ãƒ¼';
            }

            const statItems = card.querySelectorAll('.stat-item .value');
            statItems.forEach(item => {
                item.textContent = 'ã‚¨ãƒ©ãƒ¼';
            });

            card.classList.remove('loading');
        });
    }

    // å€‹åˆ¥Botæ‹›å¾…ãƒªãƒ³ã‚¯ç”Ÿæˆ
    generateInviteLink(botId) {
        return `https://discord.com/api/oauth2/authorize?client_id=${botId}&permissions=3148800&scope=bot%20applications.commands`;
    }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', () => {
    new BotStatusManager();
});

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
window.BotStatusManager = BotStatusManager;
